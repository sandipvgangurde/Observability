# üß≠ **Part 1: Grafana + Loki + Promtail (Log Monitoring Stack)**

---

## **üéØ Objective**

Install **Grafana** (for visualization) and **Loki + Promtail** (for log collection and aggregation) on Ubuntu using Docker.

You‚Äôll be able to:

* View server logs in Grafana.
* Use Loki as the log database.
* Collect logs via Promtail.

---

## ‚öôÔ∏è **Step 1: Update System and Install Basic Tools**

```bash
sudo apt-get update -y
sudo apt-get install -y software-properties-common wget curl apt-transport-https
```

> üß∞ *These packages allow you to download and manage software securely.*

---

## üìä **Step 2: Install Grafana**

### 1Ô∏è‚É£ Add Grafana Repository and GPG Key

```bash
sudo wget -q -O /usr/share/keyrings/grafana.key https://apt.grafana.com/gpg.key
echo "deb [signed-by=/usr/share/keyrings/grafana.key] https://apt.grafana.com stable main" | \
sudo tee /etc/apt/sources.list.d/grafana.list
```

### 2Ô∏è‚É£ Update and Install Grafana

```bash
sudo apt-get update
sudo apt-get install -y grafana
```

### 3Ô∏è‚É£ Enable and Start Grafana Server

```bash
sudo systemctl enable grafana-server
sudo systemctl start grafana-server
sudo systemctl status grafana-server
```

### 4Ô∏è‚É£ Access Grafana

Open your browser:

```
http://<YOUR_SERVER_IP>:3000
```

Default credentials:

```
Username: admin
Password: admin
```

> üß† You‚Äôll be asked to change the password on first login.

---

## üî• **Step 3: Open Firewall Ports**

```bash
sudo ufw allow 3000/tcp   # Grafana UI
sudo ufw allow 3100/tcp   # Loki logs
sudo ufw reload
```

---

## üê≥ **Step 4: Install Docker**

```bash
sudo apt-get install -y docker.io
sudo systemctl enable docker
sudo systemctl start docker
```

Verify:

```bash
docker ps
```

If you get a permission error:

```bash
sudo usermod -aG docker $USER
sudo reboot
```

---

## üìÅ **Step 5: Setup Loki and Promtail**

### 1Ô∏è‚É£ Create Folder for Configs

```bash
mkdir ~/grafana_config
cd ~/grafana_config
```

### 2Ô∏è‚É£ Download Config Files

### 2.1: For loki: 
```bash
wget https://raw.githubusercontent.com/grafana/loki/v2.8.0/cmd/loki/loki-local-config.yaml -O loki-config.yaml
```
#OR
```bash
auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096

common:
  instance_addr: 127.0.0.1
  path_prefix: /tmp/loki
  storage:
    filesystem:
      chunks_directory: /tmp/loki/chunks
      rules_directory: /tmp/loki/rules
  replication_factor: 1
  ring:
    kvstore:
      store: inmemory

query_range:
  results_cache:
    cache:
      embedded_cache:
        enabled: true
        max_size_mb: 100

schema_config:
  configs:
    - from: 2020-10-24
      store: boltdb-shipper
      object_store: filesystem
      schema: v11
      index:
        prefix: index_
        period: 24h

ruler:
  alertmanager_url: http://localhost:9093

# By default, Loki will send anonymous, but uniquely-identifiable usage and configuration
# analytics to Grafana Labs. These statistics are sent to https://stats.grafana.org/
#
# Statistics help us better understand how Loki is used, and they show us performance
# levels for most users. This helps us prioritize features and documentation.
# For more information on what's sent, look at
# https://github.com/grafana/loki/blob/main/pkg/usagestats/stats.go
# Refer to the buildReport method to see what goes into a report.
#
# If you would like to disable reporting, uncomment the following lines:
#analytics:
#  reporting_enabled: false
```
### 2.2 For Promtail
```bash
wget https://raw.githubusercontent.com/grafana/loki/v2.8.0/clients/cmd/promtail/promtail-docker-config.yaml -O promtail-config.yaml
```
#OR
```bash
server:
  http_listen_port: 9080
  grpc_listen_port: 0

positions:
  filename: /tmp/positions.yaml

clients:
  - url: http://loki:3100/loki/api/v1/push

scrape_configs:
- job_name: system
  static_configs:
  - targets:
      - localhost
    labels:
      job: varlogs
      __path__: /var/log/*log
  - targets:
      - localhost
    labels:
      job: grafana-logs
      __path__: /var/log/grafana/*log

```

### 3Ô∏è‚É£ Run Loki Container

```bash
docker run -d --name loki \
  -v $(pwd):/mnt/config \
  -p 3100:3100 \
  grafana/loki:2.8.0 \
  --config.file=/mnt/config/loki-config.yaml
```

Verify Loki:

```
http://<YOUR_SERVER_IP>:3100/ready
```

Should show: **ready**

---

## üì° **Step 6: Run Promtail (Log Collector)**

```bash
docker run -d --name promtail \
  -v $(pwd):/mnt/config \
  -v /var/log:/var/log \
  grafana/promtail:2.8.0 \
  --config.file=/mnt/config/promtail-config.yaml
```

> üìã Promtail reads system logs from `/var/log` and sends them to Loki.

---

## üß† **Step 7: Connect Loki to Grafana**

1. Open Grafana ‚Üí **Connections ‚Üí Data Sources**
2. Click **Add data source**
3. Choose **Loki**
4. In URL field, enter:

   ```
   http://<YOUR_SERVER_IP>:3100
   ```
5. Click **Save & Test**

‚úÖ You should see ‚ÄúData source is working‚Äù.

---

## üìä **Step 8: View Logs in Grafana**

1. Go to **Explore ‚Üí Loki**
2. Run query:

   ```
   {job="varlogs"}
   ```
3. You‚Äôll see your system logs in real time!

---

## üß† **Step 9: Grafana Dashboards (Logs View)**

### üß© What is a Dashboard?

A **Grafana Dashboard** is a visual collection of panels (tables, charts, logs) that show data from your sources (like Loki or Prometheus).

You can use:

* **Pre-built community dashboards**
* **Import from JSON files**
* **Create your own from scratch**

---

### üß≠ **Three Ways to Import Dashboards in Grafana**

#### **1Ô∏è‚É£ Import by Dashboard ID (from Grafana.com)**

1. Go to **Dashboards ‚Üí Import**
2. Enter an ID from [https://grafana.com/grafana/dashboards](https://grafana.com/grafana/dashboards)

   * Example for Loki logs: `13639`
3. Click **Load ‚Üí Select Loki as the data source ‚Üí Import**

#### **2Ô∏è‚É£ Import from a JSON File**

If you have a saved dashboard JSON file:

1. Go to **Dashboards ‚Üí Import**
2. Click **Upload JSON file**
3. Choose your `.json` dashboard file
4. Select **Loki** as the data source ‚Üí Import

#### **3Ô∏è‚É£ Create a Custom Dashboard**

1. Click **+ (Create) ‚Üí Dashboard**
2. Add a **Panel ‚Üí Choose Loki query**
3. Example query:

   ```logql
   {job="varlogs"} |~ "error"
   ```
4. Save dashboard with a meaningful name like *‚ÄúSystem Log Errors‚Äù*.

---

### üí° Recommended Dashboards for Logs:

| Dashboard Name      | Grafana.com ID | Description                               |
| ------------------- | -------------- | ----------------------------------------- |
| Loki Logs Overview  | 13639          | Visualize log volume, sources, and errors |
| Loki 2.0 Metrics    | 12019          | Loki and Promtail performance             |
| System Log Explorer | 15148          | Simple log search dashboard               |

---

### ‚úÖ **End of Part 1**

You now have:

* Grafana for visualization
* Loki for storing logs
* Promtail for sending logs to Loki

---

# üßæ **Summary Table**

| Component     | Purpose                 | Default Port | Installed In      |
| ------------- | ----------------------- | ------------ | ----------------- |
| Grafana       | Visualization dashboard | 3000         | Both Parts        |
| Loki          | Log aggregation         | 3100         | Part 1            |
| Promtail      | Log collection          | ‚Äî            | Part 1            |
| Prometheus    | Metrics collector       | 9090         | Part 2            |
| Node Exporter | System metrics          | 9100         | Optional (Part 2) |

---
